version: '3.8'

services:
    appserver:
        image: ${REGISTRY:-gcr.io/able-goods-221820}/kg-appserver-demo:${GITHUB_HASH:-latest}
        ports:
            - "5000:5000"
        env_file:
            - ./.env
        volumes:
            - /mnt/disks/demo/lmdb_database/chemicals:/home/n4j/neo4japp/services/annotations/lmdb/chemicals
            - /mnt/disks/demo/lmdb_database/compounds:/home/n4j/neo4japp/services/annotations/lmdb/compounds
            - /mnt/disks/demo/lmdb_database/diseases:/home/n4j/neo4japp/services/annotations/lmdb/diseases
            - /mnt/disks/demo/lmdb_database/genes:/home/n4j/neo4japp/services/annotations/lmdb/genes
            - /mnt/disks/demo/lmdb_database/proteins:/home/n4j/neo4japp/services/annotations/lmdb/proteins
            - /mnt/disks/demo/lmdb_database/species:/home/n4j/neo4japp/services/annotations/lmdb/species
            - /mnt/disks/demo/lmdb_database/phenotypes:/home/n4j/neo4japp/services/annotations/lmdb/phenotypes
        networks:
            - frontend
            - backend

    webserver:
        image: ${REGISTRY:-gcr.io/able-goods-221820}/kg-webserver-demo:${GITHUB_HASH:-latest}
        ports:
            - 80:80
        networks:
            - frontend

    cache-invalidator:
        image: ${REGISTRY:-gcr.io/able-goods-221820}/kg-cache-service-demo:${GITHUB_HASH:-latest}
        env_file:
            - ./.env
        networks:
            - backend

    nlpapi:
        image: ${REGISTRY:-gcr.io/able-goods-221820}/kg-nlpapi-demo:${GITHUB_HASH:-latest}
        env_file:
            - ./.env
        expose:
            - 5001
        volumes:
            - /srv/models:/models
        networks:
            - backend

    redis:
        networks:
            - backend

networks:
    frontend:
    backend:
