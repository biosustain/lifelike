---
# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - before: git submodule deinit --all -f

  - name: Access Developer assets
    init: make gcloud
    openIn: left
    openMode: tab-before

  - name: Docker services
    before: docker-compose -f docker-compose.services.yml pull
    init: docker-compose -f docker-compose.services.yml up -d --wait
    command: gp sync-done services-deployed

  - name: Appserver
    before: cd appserver
    init: |
      pipenv install --dev --keep-outdated
      gp sync-await services-deployed
    command: |
      pipenv run flask run
    env:
      FLASK_APP: app
      FLASK_ENV: Development

  - name: Angular frontend
    before: cd client
    init: yarn install
    command: |
      gp ports await 5000
      yarn run dev-start

  - name: Statistical Enrichment
    before: cd appserver
    init: pipenv install --dev --keep-outdated
    command: pipenv run fask run
    env:
      FLASK_APP: statistical_enrichment
      FLASK_ENV: Development

  - name: Cache Invalidator
    before: cd cache-invalidator
    init: pipenv install --dev --keep-outdated
    command: pipenv run python main.py

  - name: Download LMDB data files
    before: |
      gsutil cp gs://lmdb/public/lmdb_v6.tgz .
      tar zxfg lmdb.tgz

ports:
  - port: 4200
    name: client
    description: Angular Live Development Server
    visibility: public
    onOpen: open-preview

  - port: 5000
    name: appserver
    description: Flask development server
    visibility: public
    onOpen: ignore

  - port: 7600
    name: pdfparser
    description: PDF Parser service
    visibility: public
    onOpen: ignore

  - port: 5432
    name: postgres
    description: PostgresQL database
    visibility: private
    onOpen: ignore

  - port: 9200
    name: elasticsearch
    description: Elasticsearch service
    visibility: public
    onOpen: ignore

  - port: 7474
    name: neo4j-browser
    description: Neo4j browser UI
    visibility: public
    onOpen: notify

  - port: 8768
    name: neo4j-bolt
    description: Neo4j Bolt port
    visibility: public
    onOpen: ignore

  - port: 5010
    name: statistical-enrichment
    description: Statistical Enrichment service app
    visibility: public
    onOpen: ignore

image:
  file: .gitpod.Dockerfile

vscode:
  extensions:
    - ms-python.python
    - donjayamanne.python-extension-pack
    - almenon.arepl
    - esbenp.prettier-vscode
    - dbaeumer.vscode-eslint
    - mgesbert.python-path
    - christian-kohler.path-intellisense
    - DavidAnson.vscode-markdownlint
    - cyrilletuzi.angular-schematics
    - manuth.eslint-language-service
    - Angular.ng-template

gitConfig:
  diff.ignoreSubmodules: all
