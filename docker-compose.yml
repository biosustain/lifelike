version: '3.5'

services:
    pgdatabase:
        command: postgres -c max_wal_size=2GB -c log_statement='all'
        container_name: pg-database
        image: postgres:11
        environment:
            - POSTGRES_PASSWORD=postgres
        networks:
            - backend
        ports:
            - "5431:5432"

    database:
        image: neo4j:3.5.14
        container_name: n4j-database
        ports:
            - "7474:7474"
            - "7687:7687"
        networks:
            - backend

    appserver:
        container_name: n4j-appserver
        build: ./appserver
        environment:
            - FLASK_APP=app
        networks:
            - frontend
            - backend
        depends_on:
            - database
        stdin_open: true
        tty: true

    elasticsearch:
        container_name: n4j-elasticsearch
        build:
            ./elasticsearch
        environment:
            - discovery.type=single-node
            - http.max_content_length=200mb
            - bootstrap.memory_lock=true
            - xpack.graph.enabled=false
            - xpack.watcher.enabled=false
            - xpack.license.self_generated.type=basic
        ulimits:
            memlock:
                soft: -1
                hard: -1
        volumes:
            - ./elasticsearch/esdata:/usr/share/elasticsearch/data
        ports:
            - "9200:9200"
            - "9300:9300"
        networks:
            - backend

networks:
    frontend:
    backend:
