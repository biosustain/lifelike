# local development overrides

version: '3.5'

services:
    appserver:
        container_name: n4j-appserver
        command: ['bin/wait-for-postgres', 'bin/start-dev']
        build: ./appserver
        ports:
            - "5000:5000"
        environment:
            - NEO4J_HOST=n4j-database
            - NEO4J_AUTH=neo4j/password
            - FLASK_DEBUG=1
            - FLASK_ENV=development
            - FLASK_APP=app
            - FLASK_APP_CONFIG=Development
            - POSTGRES_HOST=pgdatabase
            # Postgres defaults
            - POSTGRES_PORT=5432
            - POSTGRES_USER=postgres
            - POSTGRES_PASSWORD=postgres
            - POSTGRES_DB=postgres
        networks:
            - frontend
            - backend
        depends_on:
            - database
            - pgdatabase
        stdin_open: true
        volumes:
            - ./appserver:/home/n4j
        tty: true

    database:
        environment:
            - NEO4J_AUTH=neo4j/password
        volumes:
            - ./neo4j/data:/data
            - ./neo4j/logs:/logs
            - ./neo4j/import:/import
            - ./neo4j/plugins:/plugins
            - ./neo4j/backups:/backups
    client:
        container_name: n4j-client
        # starts dev & moves the yarn.lock file so it can be committed
        command: yarn dev-start
        depends_on:
            - appserver
        volumes:
            # dev mode only: mount src dir for container to pick up edits done on host
            - ./client:/home/node/client
        ports:
            - "4200:4200"
        build: ./client
        networks:
            - frontend
        depends_on:
            - appserver
