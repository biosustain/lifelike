- name: Create elastic volume
  docker_volume:
    name: elasticdata
    driver: local

- name: Create Elasticsearch Docker network
  docker_network:
    name: "{{ network_name }}"

- name: Start Elastic
  docker_container:
    name: "{{ elasticsearch_hostname }}"
    image: "{{ elasticsearch_image }}"
    env:
        discovery.type: "single-node"
        ES_JAVA_OPTS: "-Xms512m -Xmx512m"
        xpack.security.enabled: "true"
        xpack.monitoring.collection.enabled: "true"
    volumes:
        - "esdata:/usr/share/elasticsearch/data"
    ulimits:
        - nofile:65535:65535
    networks:
        - name: "{{ network_name }}"
    state: started
    log_driver: "{{ log_driver }}"
    log_options:
        max-size: "{{ log_max_size }}"
        max-file: "{{ log_max_file }}"

- debug:
    msg: >
        Users have to be configured manually. Enable and set the password for the default users with:
        `docker exec -it {{ elasticsearch_hostname }} /bin/bash -c "elasticsearch-setup-passwords auto"`
        Edit the `vault.yml` file and copy the password values to the respective variable.