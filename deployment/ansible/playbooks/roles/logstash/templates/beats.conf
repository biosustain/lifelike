input { stdin { } }

input {
    beats {
        port => 5044
        codec => "json"
    }
}

filter {
    if "appserver" in [container][name] {
        json {
            source => "message"
        }
    }

    if "webserver" in [container][name] {
        grok {
            match => { "message" => "%{COMBINEDAPACHELOG}" }
        }
    }
}

output {
    if [@metadata][beat] in ["heartbeat", "metricbeat", "filebeat"] {
        elasticsearch {
            hosts => ["http://{{ elasticsearch_hostname }}:9200"]
            user => "elastic"
            password => "{{ elastic_password }}"
            index => "%{[@metadata][beat]}-%{[@metadata][version]}"
        }
    }
}