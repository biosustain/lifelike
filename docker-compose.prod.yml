version: '3.8'

services:
    appserver:
        ports:
            - "5000:5000"
        env_file:
            - ./.env
        volumes:
            - /mnt/disks/kg-production-persistent/lmdb/chemicals:/home/n4j/neo4japp/services/annotations/lmdb/chemicals
            - /mnt/disks/kg-production-persistent/lmdb/compounds:/home/n4j/neo4japp/services/annotations/lmdb/compounds
            - /mnt/disks/kg-production-persistent/lmdb/diseases:/home/n4j/neo4japp/services/annotations/lmdb/diseases
            - /mnt/disks/kg-production-persistent/lmdb/genes:/home/n4j/neo4japp/services/annotations/lmdb/genes
            - /mnt/disks/kg-production-persistent/lmdb/proteins:/home/n4j/neo4japp/services/annotations/lmdb/proteins
            - /mnt/disks/kg-production-persistent/lmdb/species:/home/n4j/neo4japp/services/annotations/lmdb/species
            - /mnt/disks/kg-production-persistent/lmdb/phenotypes:/home/n4j/neo4japp/services/annotations/lmdb/phenotypes
        networks:
            - frontend
            - backend

    webserver:
        ports:
            - 80:80
            - 443:443
        volumes:
            - /docker/letsencrypt-docker-nginx/src/production/dh-param/dhparam-2048.pem:/etc/ssl/certs/dhparam-2048.pem
            - /docker-volumes/etc/letsencrypt/live/kg.lifelike.bio/fullchain.pem:/etc/letsencrypt/live/kg.lifelike.bio/fullchain.pem
            - /docker-volumes/etc/letsencrypt/live/kg.lifelike.bio/privkey.pem:/etc/letsencrypt/live/kg.lifelike.bio/privkey.pem
        networks:
            - frontend

    nlpapi:
        expose:
            - 5001
        env_file:
            - ./.env
        volumes:
            - /srv/models:/models
        networks:
            - backend

    cache-invalidator:
        env_file:
            - ./.env
        networks:
            - backend

networks:
    frontend:
    backend:
