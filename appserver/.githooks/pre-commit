#!/bin/sh

# Path from shell to folder containing this file
__dir__="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd)"

# Runs linting on only files that are staged
staged_files=$(getStaged appserver '\.(py)$')

if [[ -n $staged_files ]]; then
    (
        echo "> 🌽 Running flake8..."
        echo ${staged_files} | xargs \
            docker run --rm \
            -v $(pwd)/appserver:/apps \
            $(docker build -q -f $__dir__/flake8_Dockerfile $__dir__)
    ) && (
        echo "> 🥧 Running mypy..."
        echo ${staged_files} |
            xargs $DOCKER_COMPOSE_RUN --no-deps \
                -T appserver mypy
    ) && (
        echo "> 🐍 Running pycodestyle..."
        echo ${staged_files} |
            xargs docker run --rm \
                -v $(pwd)/appserver:/data \
                cytopia/pycodestyle:2
    )
else
    echo "> Skipping python files check for appserver..."
fi
