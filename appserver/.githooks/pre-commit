#!/bin/sh

# Path from shell to folder containing this file
__dir__="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

check_python_files() {
    staged_python_files=$(getStaged appserver '\.(py)$')
    # shellcheck disable=SC2236
    if [[ -n $staged_python_files ]];
    then
        (
        echo "> 🌽 Running black..."
        echo ${staged_python_files} | \
          xargs docker run --rm \
          -v $(pwd)/appserver:/data --workdir /data \
          pyfound/black:latest_release \
          black --fast
      ) && (
        echo "> 🌽 Running flake8..."
        image_hash=$(docker build -q -f $__dir__/flake8_Dockerfile $__dir__)
        echo ${staged_python_files} | \
          xargs docker run --rm \
          -v $(pwd)/appserver:/apps \
          $image_hash
#      ) && (
#        echo "> 🥧 Running mypy..."
#        echo ${staged_python_files} | xargs docker exec appserver mypy -v
#      ) && (
#        echo "> 🐍 Running pycodestyle..."
#        echo ${staged_python_files} | \
#          xargs docker run --rm \
#          -v $(pwd)/appserver:/data \
#          cytopia/pycodestyle:2
      )
    else
      echo "> Skipping python files check for appserver..."
    fi
}

(run_prettier appserver) && check_python_files
