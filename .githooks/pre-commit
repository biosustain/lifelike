#!/bin/sh

# Runs linting checks on the appserver and client
# Can bypass via --no-verify

__dir__="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
root_dir="$( cd "$( dirname "${__dir__}}" )" &> /dev/null && pwd )"

cd $root_dir/appserver && \
   python3 -m venv venv && \
   source venv/bin/activate && \
   pip install mypy pycodestyle

echo "> ğŸ¤– Running mypy..."
mypy .
if [ $? -eq 0 ]
then
   echo "âœ… mypy success!"
else
   echo "âŒ mypy failed! Run git commit --no-verify to skip"
   exit 1
fi

echo "> ğŸ¤– Running pycodestyle..."
pycodestyle .
if [ $? -eq 0 ]
then
   echo "âœ… pycodestyle success!"
else
   echo "âŒ pycodestyle failed! Run git commit --no-verify to skip"
   exit 1
fi

cd $root_dir/client
echo "> ğŸ¤– Running yarn lint..."
yarn lint
if [ $? -eq 0 ]
then
   echo "âœ… yarn lint success!"
else
   echo "âŒ yarn lint failed! Run git commit --no-verify to skip"
   exit 1
fi