<ng-container *ngIf="loadTask.status$ | async as status">
  <div class="module" appContainerBreakpoints [appShowPlaceholders]="status.placeholdersShown">
    <div class="module-header">
      <div class="module-toolbar mt-2">
        <ng-container *ngIf="searchTypes$ | async">
          <app-content-search-form
            class="w-100"
            [queryString]="queryString$ | async"
            (queryStringChange)="queryString$.next($event)"
            (formResult)="search($event)"
          >
          </app-content-search-form>
        </ng-container>
      </div>
      <div class="d-flex w-100 justify-content-start">
        <div class="btn btn-link p-0 mr-3" (click)="openAdvancedSearch()">Advanced Search</div>
        <div class="btn btn-link p-0" (click)="openSynonymSearch()">Find Synonyms</div>
      </div>
    </div>

    <div class="flex-fill overflow-auto">
      <as-split
        class="module-body-split module-body-browser-split"
        [gutterSize]="3"
        [useTransition]="true"
        unit="pixel"
      >
        <as-split-area
          class="module-body-split-main"
          size="*"
          [minSize]="500"
          appElementObserver
          #elementObserver="appElementObserver"
        >
          <ng-container *ngIf="!valid; else searchEntered">
            <div class="module-body">
              <div class="text-center my-4 px-4">Please enter a query in the search box above.</div>
            </div>
          </ng-container>

          <ng-template #searchEntered>
            <ng-container
              *ngIf="
                (status.placeholdersShown || status.resultsShown) &&
                (loadedResults$ | async) as results
              "
            >
              <ng-container *ngIf="results.length; else noResults">
                <div
                  class="module-body text-muted"
                  [appShowPlaceholders]="status.placeholdersShown"
                  *ngIf="{
                    params: params$ | async,
                    collectionSize: collectionSize$ | async
                  } as pagination"
                >
                  <div class="mb-3">
                    <app-results-summary
                      [page]="pagination.params?.page"
                      [pageSize]="pagination.params?.limit"
                      [collectionSize]="pagination.collectionSize"
                    ></app-results-summary>
                  </div>

                  <div class="search-results search-results-selectable">
                    <div
                      *ngFor="let result of results.view$ | async"
                      class="search-results-item"
                      (appTabSelectable)="results.select(result)"
                      [class.active]="results.isSelected(result)"
                      draggable="true"
                      (dragstart)="itemDragStart($event, result.item)"
                    >
                      <div
                        class="text-truncate mb-1"
                        [title]="getBreadCrumbsTitle(result.item.parent)"
                      >
                        <app-object-path
                          [object]="result.item.parent"
                          [newTab]="true"
                        ></app-object-path>
                      </div>
                      <div class="search-results-item-header text-truncate">
                        <h5 class="text-truncate" [style.padding]="'1px 0'">
                          <app-file-type-label
                            [object]="result.item"
                            [showLabel]="false"
                            class="mr-1"
                          ></app-file-type-label>
                          <a
                            appHasPlaceholder
                            [appLink]="result.item.getCommands(false)"
                            [newTab]="true"
                            [sideBySide]="true"
                            (dragstart)="itemDragStart($event, result.item, true)"
                          >
                            <app-term-highlight
                              [text]="result.item.filename"
                              [highlightTerms]="highlightTerms"
                              [highlightOptions]="highlightOptions"
                            ></app-term-highlight>
                          </a>
                        </h5>
                      </div>
                      <div class="mt-2 text-truncate" appHasPlaceholder>
                        <i
                          >Created by
                          <app-user [user]="result.item.user"></app-user>
                          on
                          {{ result.item.creationDate | date : 'fullDate' }}</i
                        >
                      </div>
                      <div class="mt-2 paragraph-truncate-3">
                        <app-term-highlight
                          [text]="result.item.description"
                          [highlightTerms]="highlightTerms"
                          [highlightOptions]="highlightOptions"
                        ></app-term-highlight>
                      </div>
                      <ng-container *ngIf="result.item.highlight">
                        <div class="dropdown-divider"></div>
                        <div class="mt-2 paragraph-truncate-3">
                          <app-highlight-text
                            [appInnerXML]="result.item.highlight[0]"
                          ></app-highlight-text>
                        </div>
                        <div class="d-flex align-items-center justify-content-end">
                          <a *ngIf="result.item.doi" [href]="result.item.doi" target="_blank"
                            >DOI Link</a
                          >
                        </div>
                      </ng-container>
                    </div>
                  </div>
                  <div class="mt-4">
                    <ngb-pagination
                      [page]="pagination.params?.page"
                      [pageSize]="pagination.params?.limit"
                      [collectionSize]="pagination.collectionSize"
                      *ngIf="pagination.collectionSize !== undefined"
                      (pageChange)="goToPage($event)"
                    ></ngb-pagination>
                  </div>
                </div>
              </ng-container>
              <ng-template #noResults>
                <div class="module-body">
                  <div class="text-center my-4 px-4">
                    <ng-template #notEmptyParamsTemplate>
                      No records match your current filters.
                    </ng-template>
                    <ng-container *ngIf="emptyParams$ | async; else notEmptyParamsTemplate">
                      Please enter a query in the search box above.
                    </ng-container>
                  </div>
                </div>
              </ng-template>
            </ng-container>
          </ng-template>
        </as-split-area>
        <ng-container *ngIf="loadedResults$ | async as results">
          <as-split-area
            *ngIf="results.selectionLength$ | async as selectionLength"
            class="d-none d-cbp-lg-block module-body-split-sidebar"
            [visible]="selectionLength > 0"
            [size]="400"
          >
            <app-object-info
              *ngIf="results.firstSelection$ | async as firstSelection"
              [forEditing]="false"
              (highlightClick)="highlightClicked(firstSelection.item, $event)"
              (highlightDisplayLimitChange)="
                highlightDisplayLimitChanged(firstSelection.item, $event)
              "
              [object]="firstSelection.item"
              (objectOpen)="openObject($event)"
              [highlightTerms]="highlightTerms"
            ></app-object-info>
          </as-split-area>
        </ng-container>
      </as-split>
    </div>
  </div>
</ng-container>
