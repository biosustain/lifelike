<div class="border-bottom border-secondary pb-3 mb-3">
  <form [formGroup]="filtersForm" class="d-flex flex-column justify-content-between">
    <fieldset class="fieldset-properties">
      <legend class="m-0">Filters</legend>

      <!-- Minimum frequency input -->
      <div class="form-group d-flex align-items-start">
        <label [for]="minimumValueInputId" class="mt-2 mr-2 text-nowrap"
          >Min. {{ sortingAlgorithm.valueDescription }}:</label
        >
        <div>
          <input
            [id]="minimumValueInputId"
            [max]="sortingAlgorithm.max"
            [min]="sortingAlgorithm.min"
            [ngClass]="
              filtersForm.get('minimumValue').invalid
                ? 'form-control invalid-input'
                : 'form-control'
            "
            [step]="sortingAlgorithm.step"
            formControlName="minimumValue"
            type="number"
          />
          <div
            *ngIf="filtersForm.get('minimumValue').hasError('required')"
            class="mt-1 text-danger small-font"
          >
            Min frequency cannot be empty!
          </div>
          <div
            *ngIf="filtersForm.get('minimumValue').hasError('min')"
            class="mt-1 text-danger small-font"
          >
            Min frequency cannot be less than {{ sortingAlgorithm.min }}!
          </div>
          <div
            *ngIf="filtersForm.get('minimumValue').hasError('badMinMax')"
            class="mt-1 text-danger small-font"
          >
            Min frequency should not be more than {{ sortingAlgorithm.max }}!
          </div>
          <div
            *ngIf="filtersForm.get('minimumValue').hasError('pattern')"
            class="mt-1 text-danger small-font"
          >
            Min frequency must be a whole number!
          </div>
        </div>
      </div>

      <!-- TODO: Removing this for now, may bring back in the future -->
      <!-- Maximum frequency input -->
      <!-- <div class="form-group d-flex align-items-start">
        <label class="mt-2 mr-2 text-nowrap" [for]="maximumValueInputId">Max. Entity Frequency:</label>
        <div>
          <input [id]="maximumValueInputId"
                 [ngClass]="filtersForm.get('maximumValue').invalid ? 'form-control invalid-input' : 'form-control'"
                 type="number"
                 min="0"
                 step="1"
                 formControlName="maximumValue"/>
          <div class="mt-1 text-danger small-font" *ngIf="filtersForm.get('maximumValue').hasError('required')">
            Max frequency cannot be empty!
          </div>
          <div class="mt-1 text-danger small-font" *ngIf="filtersForm.get('maximumValue').hasError('min')">
            Max frequency cannot be less than 0!
          </div>
          <div class="mt-1 text-danger small-font" *ngIf="filtersForm.get('maximumValue').hasError('badMinMax')">
            Max frequency should not be less than the minimum!
          </div>
          <div class="mt-1 text-danger small-font" *ngIf="filtersForm.get('maximumValue').hasError('pattern')">
            Max frequency must be a whole number!
          </div>
        </div>
      </div> -->
    </fieldset>
  </form>

  <fieldset class="fieldset-properties mt-2">
    <legend>Grouping</legend>

    <div class="form-group d-flex align-items-center">
      <label [for]="id + '-group-by-options'" class="my-0 mr-2 text-nowrap">Group By:</label>
      <select
        (change)="groupAndSortData()"
        [(ngModel)]="selectedGroupByOption"
        [id]="id + '-group-by-options'"
        class="custom-select"
      >
        <option *ngFor="let option of groupByOptions" [value]="option">
          {{ option }}
        </option>
      </select>
    </div>

    <!-- TODO: Maybe bring these back in the future when we have additional options -->
    <!-- <div class="form-group d-flex align-items-center">
      <label [for]="id + '-order-by-options'" class="my-0 mr-2 text-nowrap">Order By:</label>
      <select [(ngModel)]="selectedOrderByOption" class="custom-select" [id]="id + '-order-by-options'" (change)="groupAndSortData()">
        <option *ngFor="let option of orderByOptions" [value]="option">
          {{option}}
        </option>
      </select>
    </div>

    <div class="form-group d-flex align-items-center">
      <label [for]="id + '-sort-direction-options'" class="my-0 mr-2 text-nowrap">Sort Direction:</label>
      <select [(ngModel)]="selectedOrderDirection" class="custom-select" [id]="id + '-sort-direction-options'" (change)="groupAndSortData()">
        <option *ngFor="let option of orderDirections" [value]="option">
          {{option}}
        </option>
      </select>
    </div> -->
  </fieldset>
</div>

<div class="mb-2">
  <button
    (click)="setAllWordsVisibility(false)"
    *ngIf="!wordVisibilityChanged"
    class="btn btn-secondary btn-block"
  >
    Hide All
  </button>
  <button
    (click)="setAllWordsVisibility(true)"
    *ngIf="wordVisibilityChanged"
    class="btn btn-secondary btn-block"
  >
    Show All
  </button>
</div>

<fieldset class="fieldset-properties mt-2">
  <legend
    container="body"
    ngbTooltip="Click a checkbox to filter annotations of that type"
    placement="top left right"
  >
    Legend
  </legend>

  <div *ngFor="let keyvalue of legend | keyvalue">
    <div *ngIf="disabledTypeMap.get(keyvalue.key); else notDisabled">
      <div class="custom-control custom-checkbox">
        <input
          (change)="changeTypeVisibility(keyvalue.key, $event)"
          [checked]="isTypeVisible(keyvalue.key)"
          [id]="id + '-legend-filter-' + keyvalue.key"
          class="custom-control-input"
          type="checkbox"
          value="1"
        />
        <label
          [autoClose]="false"
          [for]="id + '-legend-filter-' + keyvalue.key"
          class="custom-control-label text-nowrap"
          container="body"
          ngbTooltip="Entities of this type are not visible with the filters above."
          placement="right bottom top"
        >
          <span [ngStyle]="{ background: keyvalue.value }" class="entity-type-legend"></span>
          {{ keyvalue.key }}
          <i class="fa fa-exclamation-triangle text-danger ml-2"></i>
        </label>
      </div>
    </div>
    <ng-template #notDisabled>
      <div class="custom-control custom-checkbox">
        <input
          (change)="changeTypeVisibility(keyvalue.key, $event)"
          [checked]="isTypeVisible(keyvalue.key)"
          [id]="id + '-legend-filter-' + keyvalue.key"
          class="custom-control-input"
          type="checkbox"
          value="1"
        />
        <label
          [for]="id + '-legend-filter-' + keyvalue.key"
          class="custom-control-label text-nowrap"
        >
          <span [ngStyle]="{ background: keyvalue.value }" class="entity-type-legend"></span>
          {{ keyvalue.key }}
        </label>
      </div>
    </ng-template>
  </div>
</fieldset>

<fieldset class="fieldset-properties mt-2">
  <legend>Annotations</legend>
  <div *ngFor="let data of annotationVisibility">
    <div class="custom-control custom-checkbox">
      <input
        (change)="changeWordVisibility(data.identifier, $event)"
        [checked]="data.visible"
        [id]="id + 'filter-' + data.identifier"
        class="custom-control-input"
        type="checkbox"
        value="1"
      />
      <label [for]="id + 'filter-' + data.identifier" class="custom-control-label">
        <span [ngStyle]="{ background: data.entity.color }" class="entity-type-legend"></span>
        {{ data.entity.text }}
        <span>({{ data.entity.frequency }})</span>
      </label>
    </div>
  </div>
</fieldset>
