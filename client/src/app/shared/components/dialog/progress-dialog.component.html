<div class="modal-header">
  <h4 class="modal-title text-truncate">
    {{ title }}
  </h4>
</div>
<div class="modal-body">
  <ng-container *ngFor="let progressObservable of progressObservables">
    <div *ngIf="progressObservable | async as progress">
      <div class="mb-2">
        <ngb-progressbar
          *ngIf="progress.mode === 'DETERMINATE'"
          type="primary"
          [value]="progress.value * 100"
          [striped]="false"
          [animated]="false"
        >
        </ngb-progressbar>
        <ngb-progressbar
          *ngIf="progress.mode !== 'DETERMINATE'"
          type="primary"
          [value]="100"
          [striped]="true"
          [animated]="true"
        >
        </ngb-progressbar>
      </div>

      <div class="mb-2">
        {{ progress.status }}
      </div>
      <ng-template #collpsedResponseAlerts let-entities let-type="type" let-summary="summary">
        <ng-container *ngIf="entities?.length">
          <div class="mb-2">
            <app-response-alert
              *ngIf="entities.length == 1; else multiple"
              [type]="type"
              alertClass="mt-3 mb-0"
              [responseAlert]="entities[0]"
            ></app-response-alert>
            <ng-template #multiple>
              <details>
                <summary>{{ summary }} ({{ entities.length }})</summary>
                <app-response-alert
                  *ngFor="let entity of entities"
                  [type]="type"
                  alertClass="mt-3 mb-0"
                  [responseAlert]="entity"
                ></app-response-alert>
              </details>
            </ng-template>
          </div>
        </ng-container>
      </ng-template>

      <div class="mb-2" *ngIf="progress.errors?.length">
        <ng-container
          *ngTemplateOutlet="
            collpsedResponseAlerts;
            context: {
              $implicit: progress.errors,
              type: 'Error',
              summary: 'Errors'
            }
          "
        ></ng-container>
      </div>
      <div class="mb-2" *ngIf="progress.warnings?.length">
        <ng-container
          *ngTemplateOutlet="
            collpsedResponseAlerts;
            context: {
              $implicit: progress.warnings,
              type: 'Warning',
              summary: 'Warnings'
            }
          "
        ></ng-container>
      </div>

      <div class="mb-2" *ngIf="progress.info?.length">
        <ng-container
          *ngTemplateOutlet="
            collpsedResponseAlerts;
            context: {
              $implicit: progress.info,
              type: 'Info',
              summary: 'Messages'
            }
          "
        ></ng-container>
      </div>
    </div>
  </ng-container>
</div>
<div *ngIf="cancellable || persist" class="modal-footer">
  <button *ngIf="cancellable" class="btn btn-secondary" type="button" (click)="cancel()">
    Cancel
  </button>

  <button *ngIf="persist" class="btn btn-secondary" type="button" (click)="cancel()">Close</button>
</div>
