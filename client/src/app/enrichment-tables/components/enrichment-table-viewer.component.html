<div class="d-flex h-100 w-100 overflow-hidden">
  <ng-container
    *ngIf="({object: object$ | addStatus | async, document: document$ | async, table: table$ | addStatus | async}) as result">
    <ng-container *ngIf="result.object.error">
      <app-module-error [error]="result.object.error" class="d-block p-4">
      </app-module-error>
    </ng-container>

    <ng-container *ngIf="result.object.loading">
      <div class="d-flex flex-fill align-items-center justify-content-center">
        <app-module-progress>
          Loading enrichment table...
        </app-module-progress>
      </div>
    </ng-container>

    <ng-container *ngIf="result.object.value">
      <div class="module flex-fill overflow-hidden position-relative">
        <div class="module-header">
          <!-- Breadcrumbs -->
          <div class="module-breadcrumb-bar mb-1">
            <app-object-path [object]="result.object.value.parent"
                             [newTab]="true"></app-object-path>
          </div>

          <div class="d-flex flex-wrap align-items-center">
            <div class="module-title-bar mr-4">
              <h1 class="module-title text-truncate" draggable="true"
                  (dragstart)="this.dragStarted($event, result.object.value)">
                {{ result.object.value.filename }}
              </h1>

              <div ngbDropdown class="d-inline-block ml-1" container="body">
                <a href="#" class="dropdown-no-arrow" ngbDropdownToggle
                   (click)="$event.preventDefault()">
                  <i class="fas fa-chevron-down fa-fw text-icon"></i>
                </a>
                <div ngbDropdownMenu>
                  <app-object-menu [object]="result.object.value" [forEditing]="true"
                                   [showOpen]="false" [showDelete]="false"
                                   [showRestore]="true" (objectRestore)="restore($event)"
                                   (objectUpdate)="objectUpdate()">
                  </app-object-menu>
                </div>
              </div>

              <div *ngIf="unsavedChanges$.value" class="ml-1">
                <span class="badge badge-danger badge-pill ml-1"
                      ngbTooltip="Has unsaved changes" container="body">
                  <i class="fa fa-pencil-alt"></i>
                </span>
              </div>

              <div class="btn-group ml-2">
                <button type="button" class="btn btn-secondary"
                        ngbTooltip="Save" placement="bottom" container="body" (click)="save()"
                        [disabled]="!result.object.value.privileges.writable">
                  <i class="fa fa-fw fa-save"></i>
                </button>
              </div>

              <div class="btn-group ml-2">
                <button class="btn btn-secondary"
                        (click)="openEnrichmentTableEditDialog(result.document)"
                        [disabled]="!result.document || !result.object.value.privileges.writable">
                  <i class="fas fa-fw fa-dna"></i> Parameters
                </button>
                <button class="btn btn-secondary" (click)="openOrderDialog()"
                        [disabled]="!result.document || !result.object.value.privileges.writable">
                  <i class="fas fa-fw fa-sort"></i> Columns
                </button>
              </div>

              <div class="btn-group ml-2">
                <button class="btn btn-secondary" (click)="refreshData()"
                        [disabled]="!result.document">
                  <i class="fas fa-fw fa-sync"></i> Refresh Data
                </button>
              </div>
            </div>
          </div>

          <div class="text-warning mt-2" *ngIf="result.document?.duplicateGenes?.length">
            Duplicate gene names removed from
            table: {{ result.document?.duplicateGenes.join(', ') }}
          </div>
        </div>

        <ng-container *ngIf="result.table.error">
          <div class="module-body flex-fill">
            <app-module-error [error]="result.object.error" class="d-block p-4">
            </app-module-error>
          </div>
        </ng-container>

        <ng-container *ngIf="result.table.loading">
          <div class="module-body d-flex flex-fill align-items-center justify-content-center">
            <app-module-progress>
              Loading data...
            </app-module-progress>
          </div>
        </ng-container>

        <ng-container *ngIf="result.table.value">
          <div class="flex-fill d-flex position-relative overflow-hidden">
            <div class="flex-fill overflow-auto"
                 (scroll)="onTableScroll($event)"
                 [scrollTop]="scrollTopAmount">
              <app-generic-table [header]="result.table.value.tableHeader"
                                 [entries]="result.table.value.tableCells">
              </app-generic-table>
            </div>

            <button class="btn btn-secondary top-button" (click)="scrollTop()">
              <i class="fa fa-arrow-up"></i> Top
            </button>
          </div>
        </ng-container>

      </div>
    </ng-container>
  </ng-container>

</div>
