<div class="module-body-split module-body-browser-split">
  <div class="module-body-split-main">
    <table class="table module-body-table table-selectable"
           style="table-layout: fixed">
      <colgroup>
        <col>
        <col style="width: 15%; max-width: 140px" class="d-none d-cbp-sm-table-column"> <!-- Annotated -->
        <col style="width: 90px" class="d-none d-cbp-md-table-column"> <!-- Created -->
        <col style="width: 120px"> <!-- Author -->
        <col style="width: 80px"> <!-- Dropdown -->
      </colgroup>
      <thead>
      <tr>
        <th class="text-truncate">
          <ng-container *ngIf="objects != null && objects.multipleSelection; else singleSelectionSelectAll">
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" id="{{ id }}-select-all"
                     [checked]="objects.isAllSelected()"
                     (change)="objects.toggleAll()">
              <label class="custom-control-label" for="{{ id }}-select-all">Name</label>
            </div>
          </ng-container>
          <ng-template #singleSelectionSelectAll>
            Name
          </ng-template>
        </th>
        <th class="text-truncate d-none d-cbp-sm-table-cell">Annotated</th>
        <th class="text-truncate d-none d-cbp-md-table-cell">Modified</th>
        <th class="text-truncate">User</th>
        <th></th>
      </tr>
      </thead>

      <!-- Placeholders -->
      <tbody *ngIf="objects == null">
      <tr>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate d-cbp-md-table-cell">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td>
          <div class="d-flex align-items-end">
            <div ngbDropdown class="d-inline-block ml-auto">
              <button class="btn btn-sm" ngbDropdownToggle>
                <span class="placeholder-box"><i class="fas fa-cog fa-fw"></i></span>
              </button>
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate d-cbp-md-table-cell">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td>
          <div class="d-flex align-items-end">
            <div ngbDropdown class="d-inline-block ml-auto">
              <button class="btn btn-sm" ngbDropdownToggle>
                <span class="placeholder-box"><i class="fas fa-cog fa-fw"></i></span>
              </button>
            </div>
          </div>
        </td>
      </tr>
      </tbody>

      <!-- Results -->
      <tbody *ngIf="objects != null">
      <tr *ngFor="let object of objects.view; index as objectIndex" tabindex="0"
          [class.active]="this.objects.isSelected(object)" draggable="true"
          (dragstart)="dragStarted($event, object)">
        <td class="align-middle text-nowrap text-truncate"
            (click)="objects.toggle(object)">
          <div class="custom-control custom-checkbox text-truncate">
            <input type="checkbox" class="custom-control-input" id="{{ id }}-object-{{ objectIndex }}"
                   (change)="objects.toggle(object)"
                   [checked]="objects.isSelected(object)">
            <label class="custom-control-label d-block" for="{{ id }}-object-{{ objectIndex }}">
              <div class="d-flex align-items-center text-truncate"
                   popoverTitle="Description" container="body" triggers="mouseenter:mouseleave"
                   placement="right"
                   [ngbPopover]="object.description"
                   [disablePopover]="object.description == null || object.description.length === 0">
                <div class="d-inline-block mr-1">
                  <i [class]="'fa-fw text-icon ' + object.fontAwesomeIcon"></i>
                </div>

                <div class="d-inline-block text-truncate">
                  <a [appLink]="object.getCommands(forEditing)" [handleClick]="appLinks"
                     (click)="objectOpen.next(object); $event.preventDefault()">
                    <ng-container *ngIf="!object.isDirectory; else dirLabel">
                      {{ object.filename }}
                    </ng-container>
                    <ng-template #dirLabel>
                      <strong>{{ object.filename }}</strong>
                    </ng-template>
                  </a>
                </div>
              </div>
            </label>
          </div>
        </td>

        <td class="align-middle text-nowrap text-truncate d-none d-cbp-sm-table-cell"
            (click)="objects.toggle(object)">
          <div popoverTitle="Annotation Status" [ngbPopover]="object.annotationsTooltipContent"
               container="body" class="text-truncate"
               placement="right" triggers="mouseenter:mouseleave"
               [disablePopover]="!object.annotationsTooltipContent"
               *ngIf="object.isAnnotatable">
            <ng-container
              *ngIf="object.annotationsTooltipContent && object.annotationsTooltipContent.length">
              <i class="fas fa-exclamation-triangle fa-fw mr-1"></i>
            </ng-container>
            {{ (object.annotationsDate | date: 'short') || 'No annotations'}}
          </div>
        </td>

        <td class="align-middle text-nowrap text-truncate d-none d-cbp-md-table-cell"
            (click)="objects.toggle(object)">
          <div class="text-truncate" *ngIf="object.user">
            {{ getDateShown(object) | date: 'shortDate' }}
          </div>
        </td>

        <td class="align-middle text-nowrap text-truncate" (click)="objects.toggle(object)">
          <div *ngIf="object.user" class="text-truncate">
            {{ object.user.username }}
          </div>
        </td>

        <td>
          <div class="d-flex align-items-end" *ngIf="objectControls">
            <div ngbDropdown class="d-inline-block ml-auto" container="body">
              <button class="btn btn-sm" ngbDropdownToggle>
                <i class="fas fa-cog fa-fw"></i>
              </button>
              <div ngbDropdownMenu>
                <button ngbDropdownItem (click)="this.objectOpen.next(object)" [disabled]="!object.isOpenable">
                  Open
                </button>
                <ng-container *ngIf="object.privileges.writable">
                  <button ngbDropdownItem (click)="openEditDialog(object)">
                    Edit details...
                  </button>
                  <button ngbDropdownItem (click)="reannotate([object])" *ngIf="object.isAnnotatable">
                    Re-annotate
                  </button>
                </ng-container>
                <button ngbDropdownItem (click)="openVersionHistoryDialog(object)" *ngIf="object.isVersioned">
                  History...
                </button>

                <ng-container>
                  <div class="dropdown-divider"></div>
                  <button ngbDropdownItem (click)="download(object)" *ngIf="object.isDownloadable">
                    Download
                  </button>
                  <button ngbDropdownItem (click)="openExportDialog(object)" *ngIf="object.exportFormats.length">
                    Export...
                  </button>
                  <button ngbDropdownItem (click)="openShareDialog(object)">
                    Share...
                  </button>
                </ng-container>

                <ng-container
                  *ngIf="object.isCloneable || object.privileges.writable && (object.isMovable || object.isDeletable)">
                  <div class="dropdown-divider"></div>
                  <button ngbDropdownItem (click)="openCloneDialog(object)" *ngIf="object.isCloneable">
                    Copy to...
                  </button>
                  <ng-container *ngIf="object.privileges.writable && forEditing">
                    <button ngbDropdownItem (click)="openMoveDialog([object])" [disabled]="!object.isMovable">
                      Move to...
                    </button>
                  </ng-container>
                  <ng-container *ngIf="object.privileges.writable">
                    <button ngbDropdownItem (click)="openDeleteDialog([object])" [disabled]="!object.isDeletable">
                      Delete...
                    </button>
                  </ng-container>
                </ng-container>
              </div>
            </div>
          </div>
        </td>
      </tr>
      </tbody>
    </table>

    <div class="module-body" *ngIf="objects != null">
      <div *ngIf="objects.viewLength === 0" class="text-center">
        {{ emptyDirectoryMessage }}
      </div>
    </div>
  </div>

  <div class="d-none d-cbp-lg-block module-body-split-sidebar">
    <app-file-info [object]="objects.lastSelection"
                   *ngIf="objects != null && objects.selection.length"></app-file-info>
  </div>
</div>
