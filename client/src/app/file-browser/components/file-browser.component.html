<div class="module module-centered" *ngIf="(loadTask.status$ | async) as status">
  <div class="module-header-container">
    <div class="module-header">
      <div class="module-title silver" style="white-space: break-spaces;">
        <span (click)='goBack()' id='goBack' class='grey dim pointer'>Projects</span>
        <span>
          /
        </span>
        <span (click)='goUp(-1)' id='***ARANGO_USERNAME***-dir' class='blue dim pointer'>{{ projectName }}</span>
        <span *ngFor='let d of dirPathChain; let i = index;'>
          <span>
            /
          </span>
          <span class='breadcrumb-token dim pointer' (click)='goUp(i)'>
            {{d}}
          </span>
        </span>
      </div>

      <div class="module-toolbar">
        <div class="input-group">
        <span class="input-group-prepend">
          <div class="input-group-text bg-transparent border-right-0">
            <i class="fa fa-search"></i>
          </div>
        </span>
          <input class="form-control py-2 pl-0 border-left-0 border" (keyup)="applyFilter($event.target.value)"
                 placeholder="Search files..." [disabled]="status.running" maxlength="40">
        </div>
      </div>
    </div>
  </div>

  <div class="module-body">
    <!-- Action Buttons -->
    <div class="mb-4 d-flex">
      <div>
        <button class="btn btn-primary"
          (click)="displayUploadDialog()">
          <i class="fa fa-fw fa-file-upload"></i>
          Add File
        </button>
        <button class="btn btn-primary ml-2"
          (click)="addDir()">
          <i class="fa fa-fw fa-folder-plus"></i> Add Directory
        </button>
        <button class="btn btn-primary ml-2"
          (click)="addMap()">
          <i class="fa fa-fw fa-project-diagram"></i> Add Map
        </button>
        <!--
        <div class="d-inline-block"
            [ngbTooltip]="getSelectedShownFiles().length === 0 ? 'Select one or more files first.' : ''">
          <button class="btn btn-primary ml-2"
            [disabled]="getSelectedShownFiles().length !== 1" (click)="displayEditDialog()">
            <i class="fa fa-fw fa-pencil"></i> Edit
          </button>
          <button class="btn btn-outline-secondary ml-2"
                  [disabled]="getSelectedShownFiles().length === 0" (click)="reannotate()">
            Reannotate
          </button>
          <button class="btn btn-outline-secondary ml-2"
                  [disabled]="getSelectedShownFiles().length === 0"
                  (click)="displayDeleteDialog()">
            Delete
          </button>
        </div>
        -->
      </div>
      <div class="ml-auto">
        <button type="button" class="btn btn-outline-secondary ml-2" (click)="this.refresh()"
                ngbTooltip="Refresh the results">
          <i class="fa fa-sync"></i>
        </button>
      </div>
    </div>

    <app-background-task-progress
      [status]="status" (refresh)="this.refresh()" childClass="mb-2"></app-background-task-progress>

    <!-- Table File View -->
    <table class="table" [class.table-selectable]="status.resultsShown" style="table-layout: fixed">
      <colgroup>
        <col style="width: 60%">
      </colgroup>
      <thead>
      <tr>
      <tr>
        <th>
          <!--
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="select-all"
                   [checked]="isAllSelected()" (change)="toggleAllSelected()">
            <label class="custom-control-label" for="select-all">
              Name
            </label>
          </div>
          -->
          Name
        </th>
        <th class="d-none d-lg-table-cell">Submitter</th>
        <th class="d-none d-md-table-cell">Kind</th>
        <th class="d-none d-md-table-cell">
        </th>
        <!--
        <th class="d-none d-lg-table-cell">Modified</th>
        <th class="d-none d-md-table-cell">Annotations</th>
        -->
      </tr>
      </thead>

      <tbody *ngIf="status.placeholdersShown">
      <tr>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <!--
        <td class="align-middle d-none d-md-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading</span>
        </td>
        <td class="align-middle d-none d-md-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading</span>
        </td>
        -->
      </tr>
      <tr>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading loading</span>
        </td>
        <td class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading loading</span>
        </td>
        <td class="align-middle text-nowrap text-truncate">
          <span class="placeholder-box">Loading loading</span>
        </td>
        <!--
        <td class="align-middle d-none d-md-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading</span>
        </td>
        <td class="align-middle d-none d-md-table-cell text-nowrap text-truncate">
          <span class="placeholder-box">Loading</span>
        </td>
        -->
      </tr>
      </tbody>

      <tbody *ngIf="status.resultsShown">
      <tr *ngFor="let file of fileCollection"
          tabindex="0">
        <td [ngSwitch]="file.type"  class="align-middle text-nowrap text-truncate">
          <!--
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="file-{{ file.file_id }}"
                   (change)="selection.toggle(file)"
                   [checked]="selection.isSelected(file)">
            <label [ngSwitch]="file.type" class="custom-control-label d-flex align-items-center" for="file-{{ file.file_id }}">
              {{file.filename}}
            </label>
          </div>
          -->
          <!-- Rendering filename based on type -->
          <a *ngSwitchCase="'map'" [href]="file.routeLink" [appLink]="file.routeLink" class="text-truncate">
            {{ file.label }}
          </a>
          <a *ngSwitchCase="'pdf'" [href]="file.routeLink" [appLink]="file.routeLink" class="text-truncate">
            {{ file.filename }}
          </a>
          <a *ngSwitchCase="'dir'" [href]="file.routeLink" [appLink]="file.routeLink" class="text-truncate">
            {{ file.name }}
          </a>
        </td>
        <!-- Rendering author based on type -->
        <td [ngSwitch]="file.type" class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          <span *ngSwitchCase="'pdf'">
            {{ file.username }}
          </span>
          <span *ngSwitchCase="'map'">
            {{ file.author }}
          </span>
          <span *ngSwitchDefault></span>
        </td>
        <!-- Rendering based on type -->
        <td [ngSwitch]='file.type' class="align-middle d-none d-md-table-cell text-nowrap text-truncate">
          <span *ngSwitchCase="'pdf'">
            File
          </span>
          <span *ngSwitchCase="'map'">
            Map
          </span>
          <span *ngSwitchCase="'dir'">
            Directory
          </span>
          <span *ngSwitchDefault></span>
        </td>
        <td class="d-none d-md-table-cell pointer dim" (click)='delete()'>
          <span class="fa fa-fw fa-trash-o text-danger"></span>
        </td>
        <!--
        <td class="align-middle d-none d-lg-table-cell text-nowrap text-truncate">
          {{ file.creation_date | date:'shortDate' }}
        </td>
        <td class="align-middle d-none d-md-table-cell text-nowrap text-truncate"
            [ngbTooltip]="!file.annotations_date_tooltip || file.annotations_date_tooltip.length === 0 ? '' : file.annotations_date_tooltip">
          <span class="fa fa-fw fa-exclamation-triangle text-danger"
                *ngIf="file.annotations_date_tooltip?.length > 0"></span>
          {{ file.annotations_date | date:'shortDate' }}
        </td>
        -->
      </tr>
      </tbody>
    </table>

    <div *ngIf="status.emptyResultsShown && fileCollection.length === 0" class="text-center my-4">
      There are no files to show.
    </div>
  </div>

</div>
