<div class="module module-centered" *ngIf="(loadTask.status$ | async) as status">
  <div class="module-header-container">
    <div class="module-header">
      <div class="module-title">
        File Browser
      </div>
      <div class="module-toolbar">
        <div class="input-group">
        <span class="input-group-prepend">
          <div class="input-group-text bg-transparent border-right-0">
            <i class="fa fa-search"></i>
          </div>
        </span>
          <input class="form-control py-2 pl-0 border-left-0 border" (keyup)="applyFilter($event.target.value)"
                 placeholder="Search files..." [disabled]="status.running" maxlength="40">
        </div>
      </div>
    </div>
  </div>

  <div class="module-body">
    <div class="mb-4 d-flex">
      <div>
        <button class="btn btn-primary" (click)="openUploadDialog()">
          <i class="fa fa-fw fa-file-upload"></i>
          Add File
        </button>
        <div class="d-inline-block"
             [ngbTooltip]="getSelectedShownFiles().length === 0 ? 'Select one or more files to use these options' : ''">
          <button class="btn btn-outline-secondary ml-2"
                  [disabled]="getSelectedShownFiles().length === 0 || isReannotating" (click)="reannotate()">
            Reannotate <span *ngIf="getSelectedShownFiles().length">({{getSelectedShownFiles().length}})</span>
          </button>
          <button class="btn btn-outline-secondary ml-2"
                  [disabled]="getSelectedShownFiles().length === 0"
                  (click)="openDeleteDialog()">
            Delete <span *ngIf="getSelectedShownFiles().length">({{getSelectedShownFiles().length}})</span>
          </button>
        </div>
      </div>
      <div class="ml-auto">
        <button type="button" class="btn btn-outline-secondary ml-1" (click)="this.updateDataSource()"
                ngbTooltip="Refresh the results">
          <i class="fa fa-sync"></i>
        </button>
      </div>
    </div>

    <div *ngIf="status.retryInProgressShown" class="mb-2">
      <div class="alert alert-warning m-0">
        <div>
          This is taking longer than expected.
        </div>
      </div>
    </div>

    <div *ngIf="status.failedErrorShown" class="mb-2">
      <div class="alert alert-danger m-0">
        <div>
          The list of files is currently not available.
        </div>
        <div class="mt-1">
          <button type="button" class="btn btn-sm btn-outline-danger" (click)="this.updateDataSource()">
            Retry
          </button>
        </div>
      </div>
    </div>

    <div class="progress mb-2" *ngIf="status.progressShown">
      <div class="progress-bar progress-bar-striped progress-bar-animated bg-secondary" style="width: 100%"></div>
    </div>

    <table class="table" [class.table-selectable]="status.resultsShown" style="table-layout: fixed">
      <colgroup>
        <col style="width: 60%">
      </colgroup>
      <thead>
      <tr>
      <tr>
        <th>
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="select-all"
                   [checked]="isAllSelected()" (change)="toggleAllSelected()">
            <label class="custom-control-label" for="select-all">
              Name
            </label>
          </div>
        </th>
        <th class="d-none d-lg-table-cell">Modified</th>
        <th class="d-none d-md-table-cell">Submitter</th>
      </tr>
      </thead>

      <tbody *ngIf="status.placeholdersShown">
      <tr>
        <td>
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td>
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td>
          <span class="placeholder-box">Loading loading</span>
        </td>
      </tr>
      <tr>
        <td>
          <span class="placeholder-box">Loading loading loading</span>
        </td>
        <td>
          <span class="placeholder-box">Loading loading</span>
        </td>
        <td>
          <span class="placeholder-box">Loading loading loading</span>
        </td>
      </tr>
      </tbody>

      <tbody *ngIf="status.resultsShown">
      <tr *ngFor="let file of shownFiles"
          (click)="selection.toggle(file)"
          [class.active]="selection.isSelected(file)"
          (keydown)="$event.keyCode != 13 || selection.toggle(file)"
          tabindex="0">
        <td class="align-middle text-truncate mw-100">
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="file-{{ file.file_id }}"
                   (change)="selection.toggle(file)"
                   [checked]="selection.isSelected(file)">
            <label class="custom-control-label d-flex align-items-center" for="file-{{ file.file_id }}">
              <a href="#" [appLink]="'/pdf-viewer/' + file.file_id" class="text-truncate">
                {{ file.filename }}
              </a>
            </label>
          </div>
        </td>
        <td class="align-middle d-none d-lg-table-cell">
          {{ file.creation_date | date:'short' }}
        </td>
        <td class="align-middle d-none d-md-table-cell">
          {{ file.username }}
        </td>
      </tr>
      </tbody>
    </table>

    <div *ngIf="status.emptyResultsShown && shownFiles.length === 0" class="text-center my-4">
      There are no files to show.
    </div>
  </div>

</div>
