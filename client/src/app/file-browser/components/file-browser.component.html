<ng-container *ngIf="(object$ | addStatus | async) as result">
  <ng-template [ngIf]="result.error">
    <app-module-error [error]="result.error" class="d-block p-4">
      <a appLink="/projects">Go to Projects <i class="fa fa-fw fa-arrow-right"></i></a>
    </app-module-error>
  </ng-template>

  <ng-template [ngIf]="result.loading">
    <div class="module" appContainerBreakpoints>
      <!-- Header -->
      <div class="module-header">
        <!-- Breadcrumbs -->
        <div class="module-breadcrumb-bar mb-1">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a appLink="/projects">File Browser</a>
            </li>
            <li class="breadcrumb-item">
              <span class="placeholder-box">Loading loading</span>
            </li>
            <li class="breadcrumb-item">
              <span class="placeholder-box">Loading</span>
            </li>
            <li class="breadcrumb-item">
              <span class="placeholder-box">Loading load</span>
            </li>
          </ol>
        </div>

        <!-- Title bar -->
        <div class="module-title-bar">
          <h1 class="module-title">
            <span class="placeholder-box">Loading</span>
          </h1>
        </div>

        <!-- Toolbar -->
        <div class="module-toolbar mt-2">
          <div class="d-flex align-items-center flex-spaced-wrap">
            <div class="flex-grow-1 text-nowrap overflow-x-hidden">
              <div ngbDropdown class="d-inline-block" container="body">
                <button class="btn btn-primary" ngbDropdownToggle [disabled]="true">
                  <i class="fa fa-fw fa-plus-circle"></i>
                  New
                </button>
                <div ngbDropdownMenu>
                </div>
              </div>

              <button class="btn btn-primary ml-2" disabled>
                <i class="fa fa-fw fa-upload"></i> Upload
              </button>

              <button class="btn btn-secondary ml-2" disabled>
                <i class="fa fa-fw fa-redo"></i>
              </button>

              <button class="btn btn-secondary ml-2" disabled>
                <i class="fa fa-fw fa-trash"></i>
              </button>

              <button class="btn btn-secondary ml-4" disabled>
                <i class="fa fa-fw fa-cloud"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Body -->
      <div class="flex-fill overflow-auto">
        <div class="module-body-split module-body-browser-split">
          <div class="module-body-split-main">
            <table class="table module-body-table" [class.table-selectable]="result.value"
                   style="table-layout: fixed">
              <colgroup>
                <col>
                <col style="width: 15%; max-width: 140px" class="d-none d-cbp-sm-table-column"> <!-- Annotated -->
                <col style="width: 90px" class="d-none d-cbp-md-table-column"> <!-- Created -->
                <col style="width: 120px"> <!-- Author -->
                <col style="width: 80px"> <!-- Dropdown -->
              </colgroup>
              <thead>
              <tr>
                <th class="text-truncate">
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="select-all-placeholder">
                    <label class="custom-control-label" for="select-all-placeholder">Name</label>
                  </div>
                </th>
                <th class="text-truncate d-none d-cbp-sm-table-cell">Annotated</th>
                <th class="text-truncate d-none d-cbp-md-table-cell">Modified</th>
                <th class="text-truncate">User</th>
                <th></th>
              </tr>
              </thead>

              <!-- Placeholders -->
              <tbody>
              <tr>
                <td class="align-middle text-nowrap text-truncate">
                  <span class="placeholder-box">Loading loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate d-none d-cbp-sm-table-cell">
                  <span class="placeholder-box">Loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate d-none d-cbp-md-table-cell">
                  <span class="placeholder-box">Loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate">
                  <span class="placeholder-box">Loading loading</span>
                </td>
                <td>
                  <div class="d-flex align-items-end">
                    <div ngbDropdown class="d-inline-block ml-auto">
                      <button class="btn btn-sm" ngbDropdownToggle>
                        <span class="placeholder-box"><i class="fas fa-cog fa-fw"></i></span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="align-middle text-nowrap text-truncate">
                  <span class="placeholder-box">Loading loading loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate d-none d-cbp-sm-table-cell">
                  <span class="placeholder-box">Loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate d-none d-cbp-md-table-cell">
                  <span class="placeholder-box">Loading</span>
                </td>
                <td class="align-middle text-nowrap text-truncate">
                  <span class="placeholder-box">Loading loading</span>
                </td>
                <td>
                  <div class="d-flex align-items-end">
                    <div ngbDropdown class="d-inline-block ml-auto">
                      <button class="btn btn-sm" ngbDropdownToggle>
                        <span class="placeholder-box"><i class="fas fa-cog fa-fw"></i></span>
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template [ngIf]="result.value">
    <div class="module" appContainerBreakpoints>
      <!-- Header -->
      <div class="module-header">
        <!-- Breadcrumbs -->
        <div class="module-breadcrumb-bar mb-1">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a appLink="/projects">File Browser</a>
            </li>

            <li *ngFor="let element of result.value.path; index as i" class="breadcrumb-item"
                [class.active]="i === result.value.path.length - 1">
              <ng-container *ngIf="i !== result.value.path.length - 1">
                <a
                    [appLink]="i === 0 ? ['/projects', result.value.locator.projectName] : ['/projects', result.value.locator.projectName, 'folders', element.id]">
                  {{ i === 0 ? result.value.locator.projectName : element.name }}
                </a>
              </ng-container>
            </li>
          </ol>
        </div>

        <!-- Title bar -->
        <div class="module-title-bar">
          <button type="button" class="module-title-bar-back mr-2" (click)="goUp(result.value)">
            <i class="fa fa-fw fa-arrow-left"></i>
          </button>
          <h1 class="module-title">
            {{ result.value.path == null || result.value.path.length === 1 ? result.value.locator.projectName : result.value.directory?.name }}
          </h1>
        </div>

        <!-- Toolbar -->
        <div class="module-toolbar mt-2">
          <div class="d-flex align-items-center flex-spaced-wrap">
            <div class="flex-grow-1 text-nowrap overflow-x-hidden">
              <div ngbDropdown class="d-inline-block" container="body">
                <button class="btn btn-primary" ngbDropdownToggle>
                  <i class="fa fa-fw fa-plus-circle"></i>
                  New
                </button>
                <div ngbDropdownMenu>
                  <button ngbDropdownItem (click)="openMapCreateDialog(result.value)">New Map...</button>
                  <button ngbDropdownItem (click)="openDirectoryCreateDialog(result.value)">New Folder...</button>
                  <button ngbDropdownItem (click)="openEnrichmentTableCreateDialog(result.value)">New Enrichment Table...
                  </button>
                  <div class="dropdown-divider"></div>
                  <button ngbDropdownItem (click)="openUploadDialog(result.value)">Upload File...</button>
                </div>
              </div>

              <button class="btn btn-primary ml-2"
                      (click)="openUploadDialog(result.value)">
                <i class="fa fa-fw fa-upload"></i> Upload
              </button>

              <button class="btn btn-secondary ml-2"
                      [disabled]="result.value.children.selection.length === 0"
                      (click)="reannotate(result.value.children.selection)" ngbTooltip="Re-annotate document"
                      container="body">
                <i class="fa fa-fw fa-redo"></i>
              </button>

              <button class="btn btn-secondary ml-2"
                      [disabled]="result.value.children.selection.length === 0"
                      (click)="openDeleteDialog(result.value.children.selection)">
                <i class="fa fa-fw fa-trash"></i>
              </button>

              <button #entityCloudBtn class="btn btn-secondary ml-4" ngbTooltip="Project Entity Cloud"
                      (click)="openEntityCloudPane(); entityCloudBtn.blur()">
                <i class="fa fa-fw fa-cloud"></i>
              </button>
            </div>

            <div class="ml-auto d-flex flex-grow-1">
              <div class="input-group" [class.bg-highlight]="result.value.children.filter != null">
                <div class="input-group-prepend">
                  <div class="input-group-text bg-transparent border-right-0">
                    <i class="fa fa-search"></i>
                  </div>
                </div>
                <input class="form-control py-2 pl-0 border-left-0 border bg-transparent"
                       (keyup)="applyFilter(result.value, $event.target.value)"
                       placeholder="Find" maxlength="40">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Body -->
      <div class="flex-fill overflow-auto">
        <app-file-list [parent]="result.value" [appLinks]="true"
                       (locatorChange)="load($event)"
                       (objectOpen)="openObject($event)"></app-file-list>
      </div>

    </div>
  </ng-template>
</ng-container>
