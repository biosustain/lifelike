<form [formGroup]="form" (ngSubmit)="submit()">
  <app-modal-header (cancel)="cancel()">
    {{ title }}
  </app-modal-header>

  <app-modal-body>
    <ng-container *ngIf="promptUpload">
      <ul ngbNav #nav="ngbNav" class="nav-tabs" [activeId]="form.get('contentSource').value"
          (activeIdChange)="activeTabChanged($event)">
        <li ngbNavItem="contentValue">
          <a ngbNavLink>From Device</a>
          <ng-template ngbNavContent>
            <app-form-row for="content-value" label="File" [control]="form.get('contentValue')">
              <div class="d-flex align-items-center text-truncate">
                <button type="button" class="btn btn-secondary mr-2" (click)="showFileDialog()">
                  Browse...
                </button>
                <div class="text-truncate" *ngIf="form.get('contentValue').value != null; else noFileChosen">
                  <i class="fa fa-fw fa-file-upload text-icon"></i>
                  {{ form.get('contentValue').value.name }}
                </div>
                <ng-template #noFileChosen>
                </ng-template>
              </div>
              <input type="file" id="content-value" (change)="fileChanged($event)"
                     accept="application/pdf, application/json"
                     class="d-none" #fileInput>
            </app-form-row>
          </ng-template>
        </li>
        <li ngbNavItem="contentUrl">
          <a ngbNavLink>From URL</a>
          <ng-template ngbNavContent>
            <app-form-row for="content-url" label="URL" [control]="form.get('contentUrl')">
              <input type="text" formControlName="contentUrl" id="content-url" [appFormInput]="form.get('contentUrl')"
                     placeholder="https://www.example.com/file.pdf" (change)="urlChanged($event)">
            </app-form-row>
          </ng-template>
        </li>
      </ul>

      <div [ngbNavOutlet]="nav" class="mt-4"></div>
    </ng-container>

    <app-form-row for="parent" [label]="parentLabel" [control]="form.get('parent')" *ngIf="promptParent">
      <div class="d-flex align-items-center text-truncate">
        <button type="button" class="btn btn-secondary mr-2" (click)="showParentDialog()">
          Browse...
        </button>
        <div class="text-truncate" *ngIf="form.get('parent').value != null; else noParentChosen">
          <i class="fa fa-fw fa-folder text-icon"></i>
          {{ form.get('parent').value.effectiveName }}
        </div>
        <ng-template #noParentChosen>
        </ng-template>
      </div>
    </app-form-row>

    <app-form-row for="filename" label="Filename" [control]="form.get('filename')">
      <input type="text" formControlName="filename" id="filename" [appFormInput]="form.get('filename')"
             appAutoFocus [autoSelect]="true">
    </app-form-row>

    <app-form-row for="description" label="Description" [control]="form.get('description')">
      <textarea formControlName="description" id="description" [appFormInput]="form.get('description')"
                rows="10"></textarea>
    </app-form-row>

    <app-form-row [control]="form.get('public')" *ngIf="!object.isDirectory">
      <div class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" id="public" formControlName="public">
        <label class="custom-control-label" for="public">Publicly share with the community</label>
      </div>
    </app-form-row>

    <ng-container *ngIf="promptAnnotationOptions && possiblyAnnotatable">
      <fieldset class="fieldset-properties mt-4">
        <legend>Annotation Options (If Applicable)</legend>
        <app-form-row
          label="Organism"
          ngbTooltip="If you know the specific organism strain related to the paper, you may optionally search for it by name here."
        >
          <app-organism-autocomplete
            formId="organism"
            [organismTaxId]="form.get('organism').value"
            (organismPicked)="organismChanged($event)"
          ></app-organism-autocomplete>
        </app-form-row>

        <ng-container *ngIf="(userRoles$ | async)?.includes('admin')">
          <app-form-row class="mt-2" for="annotationMethod" label="Annotations"
                        [control]="form.get('annotationMethod')">
            <div *ngFor="let method of annotationMethodChoices">
              <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input"
                       id="annotation-type-{{method.replace(' ', '-') | lowercase}}"
                       (change)="onAnnotationMethodPick(method, $event.target.checked)"
                       [checked]="form.get('annotationMethod').value === method"
                       [disabled]="method === 'NLP'">
                <label class="custom-control-label d-flex align-items-center"
                       for="annotation-type-{{method.replace(' ', '-') | lowercase}}">
                  {{ method }}
                </label>
              </div>
            </div>
          </app-form-row>
        </ng-container>
      </fieldset>
    </ng-container>
  </app-modal-body>

  <app-modal-footer>
    <button type="button" class="btn btn-secondary mr-2" (click)="cancel()">Cancel</button>
    <button type="submit" class="btn btn-primary">Save</button>
  </app-modal-footer>
</form>
