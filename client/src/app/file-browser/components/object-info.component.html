<div class="d-flex flex-column h-100">
  <div class="module-body">
    <div class="mb-3">
      <app-file-type-label [object]="object"></app-file-type-label>
    </div>

    <h5 (click)="objectEdit.emit(object)">
      <div *ngIf="object.filename.slice(object.filename.length - 11) !== '.enrichment'">
        <app-term-highlight
          [highlightOptions]="highlightOptions"
          [highlightTerms]="highlightTerms"
          [text]="object.filename"
        ></app-term-highlight>
      </div>
      <div *ngIf="object.filename.slice(object.filename.length - 11) === '.enrichment'">
        <app-term-highlight
          [highlightOptions]="highlightOptions"
          [highlightTerms]="highlightTerms"
          [text]="object.filename.slice(0, -11)"
        ></app-term-highlight>
      </div>
    </h5>

    <div
      (click)="objectEdit.emit(object)"
      *ngIf="object.description"
      [style.white-space]="'pre-wrap'"
      class="mt-3"
    >
      <app-term-highlight
        [highlightOptions]="highlightOptions"
        [highlightTerms]="highlightTerms"
        [text]="object.description"
      ></app-term-highlight>
    </div>

    <hr class="my-3" />

    <ul class="list-unstyled mt-3 mb-0">
      <li *ngIf="object.public"><i class="fa fa-fw text-icon fa-globe"></i> Public</li>
      <li *ngIf="object.parent">
        <strong>Path:</strong>
        <app-object-path
          [newTab]="true"
          [object]="object.parent"
          [wrap]="true"
          class="d-inline-block ml-2"
        ></app-object-path>
      </li>
      <li *ngIf="object.isAnnotatable">
        <strong>Annotated:</strong>
        <span *ngIf="object.annotationsDate; else noAnnotations">
          {{ object.annotationsDate | date : "short" }}
        </span>
        <ng-template #noAnnotations>
          <em class="text-muted">Not annotated</em>
        </ng-template>
      </li>
      <li *ngIf="object.isAnnotatable">
        <strong>Annotation Organism:</strong>&nbsp;<app-organism
          [highlightTerms]="highlightTerms"
          [organism]="object.fallbackOrganism"
        ></app-organism>
      </li>
      <li *ngIf="object.modifiedDate">
        <strong>Modified:</strong> {{ object.modifiedDate | date : "short" }}
      </li>
      <li *ngIf="object.creationDate">
        <strong>Created:</strong> {{ object.creationDate | date : "short" }}
      </li>
      <li *ngIf="object.user">
        <strong>Author:</strong>&nbsp;<app-user
          [highlightTerms]="highlightTerms"
          [user]="object.user"
        ></app-user>
      </li>
      <li *ngIf="object.doi" class="text-truncate">
        <strong>DOI:</strong>&nbsp;<a [href]="object.doi" target="_blank">{{ object.doi }}</a>
      </li>
      <li *ngIf="object.uploadUrl" class="text-truncate">
        <strong>External URL:</strong>&nbsp;<a [href]="object.uploadUrl" target="_blank">{{
          object.uploadUrl
        }}</a>
      </li>
    </ul>
    <div *ngIf="objectControls" class="mt-3">
      <div container="body" ngbDropdown>
        <button class="btn btn-secondary" ngbDropdownToggle>Actions</button>
        <div ngbDropdownMenu>
          <app-object-menu
            (objectOpen)="objectOpen.emit($event)"
            (refreshRequest)="refreshRequest.emit($event)"
            [forEditing]="forEditing"
            [object]="object"
            [showDelete]="showDelete"
          >
          </app-object-menu>
        </div>
      </div>
    </div>
    <div *ngIf="object.type === 'file' && object.highlight" class="mt-5">
      <h5>Term matches in document:</h5>
      <div (dragstart)="highlightDragStart($event)" *ngFor="let highlight of shownHighlights">
        <hr class="my-3" />
        <div class="mt-2">
          <app-highlight-text [appInnerXML]="highlight"></app-highlight-text>
          <a
            (click)="highlightClick.emit(highlight); $event.preventDefault()"
            href="#"
            ngbTooltip="Find in document"
          >
            (open)
          </a>
        </div>
      </div>
      <div *ngIf="!reachedHighlightLimit" class="mt-4">
        <a (click)="displayMoreHighlights(); $event.preventDefault()" href="#">More...</a>
      </div>
    </div>
  </div>
  <div class="flex-grow-1 position-relative overflow-auto">
    <div class="border-top h-100">
      <app-object-preview [highlightTerms]="highlightTerms" [object]="object"></app-object-preview>
    </div>
  </div>
</div>
