<!--
  fxLayout is inverted due to the horizontal stepper
-->
<div
  fxLayout="column"
  fxLayoutGap="30px"
>
  <div>
    <mat-form-field>
      <input
        type="text"
        matInput
        [(ngModel)]="nodeType"
      />
    </mat-form-field>
  </div>
  <!-- column name table -->
  <div [formGroup]="columnMappingForm">
    <!-- <div>
      <strong>Unique ID</strong>: This is the column that is unique and used to identify a node (and for indexing). Usually the name column.<br>
      <strong>Exclude</strong>: Excluded columns will not be included as node properties in the graph database.<br>
    </div> -->
    <mat-table [dataSource]="chosenSheetToMap?.sheetColumnNames" formArrayName="columnMapping">
      <mat-header-row *matHeaderRowDef="columns"></mat-header-row>
      <mat-row *matRowDef="let row; let i=index; columns: columns;" [attr.id]="'file-column-name-row-'+i"></mat-row>

      <!-- begin creating table -->
      <ng-container matColumnDef="columnName">
        <mat-header-cell *matHeaderCellDef>Column Name</mat-header-cell>
        <mat-cell *matCellDef="let object; let i=index;">{{ (object | keyvalue)[0].key }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="mappedNodeType">
        <mat-header-cell *matHeaderCellDef>Mapped Node Type</mat-header-cell>
        <mat-cell *matCellDef="let data; let i=index;" [formGroupName]="i">
          <mat-form-field>
            <mat-select
              placeholder="Select node type"
              formControlName="mappedNodeType"
              (selectionChange)="selectionChange($event)"
            >
              <mat-option
                *ngFor="let label of (dbNodeTypes$ | async)"
                [value]="label"
              >{{ label }}</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="mappedNodeProperty">
        <mat-header-cell *matHeaderCellDef>Mapped Node Property</mat-header-cell>
        <mat-cell *matCellDef="let data; let i=index;" [formGroupName]="i">
          <mat-form-field>
            <mat-select
              placeholder="Select node property"
              formControlName="mappedNodeProperty"
            >
              <span *ngIf="(dbNodeProperties$ | async)">
                <mat-option
                  *ngFor="let label of (dbNodeProperties$ | async)[columnMappingForm.get(
                    'columnMapping').controls[i].get('mappedNodeType').value]"
                  [value]="label"
                >{{ label }}</mat-option>
              </span>
            </mat-select>
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="nodeProperty">
        <mat-header-cell *matHeaderCellDef>Node Property</mat-header-cell>
        <mat-cell *matCellDef="let object; let i=index" [formGroupName]="i">
          <mat-checkbox
            formControlName="nodeProperty"
            (change)="updateColumnMapping($event, columnType.NODE_PROPERTY, i)"></mat-checkbox>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="exclude">
        <mat-header-cell *matHeaderCellDef>Exclude</mat-header-cell>
        <mat-cell *matCellDef="let object; let i=index" [formGroupName]="i">
          <mat-checkbox
            formControlName="exclude"
            (change)="updateColumnMapping($event, columnType.EXCLUDE, i)"></mat-checkbox>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="unique">
        <mat-header-cell *matHeaderCellDef>Unique</mat-header-cell>
        <mat-cell *matCellDef="let object; let i=index" [formGroupName]="i">
          <mat-checkbox
            formControlName="unique"
            (change)="updateColumnMapping($event, columnType.UNIQUE, i)"></mat-checkbox>
        </mat-cell>
      </ng-container>
    </mat-table>
  </div>
  <!-- end column name table -->

  <div>
    <button
      mat-stroked-button
      type="button"
      (click)="createColumnMapping()"
    >Save</button>
  </div>
</div>
