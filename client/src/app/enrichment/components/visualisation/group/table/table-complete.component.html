<form>
  <div
    *ngIf="showMore"
    class="form-group form-inline d-flex justify-content-between align-items-stretch"
  >
    <span class="flex-grow-0"
      >Search:
      <input
        [(ngModel)]="service.searchTerm"
        class="form-control ml-2"
        name="searchTerm"
        type="text"
      />
    </span>
    <span *ngIf="service.loading$ | async" class="ml-3">Loading...</span>
  </div>
  <table class="table table-striped">
    <ng-template #legend>
      <dl class="legend">
        <dt>' '</dt>
        <dd><i>q-value</i> <= 1</dd>
        <dt>.</dt>
        <dd><i>q-value</i> <= 0.1</dd>
        <dt>*</dt>
        <dd><i>q-value</i> <= 0.05</dd>
        <dt>**</dt>
        <dd><i>q-value</i> <= 0.01</dd>
        <dt>***</dt>
        <dd><i>q-value</i> <= 0.001</dd>
      </dl>
    </ng-template>
    <thead>
      <tr>
        <th (sort)="onSort($event)" appSortable="goId" scope="col">GOID</th>
        <th (sort)="onSort($event)" appSortable="goTerm" scope="col">GO Term</th>
        <th (sort)="onSort($event)" appSortable="geneNames" scope="col">Associated genes</th>
        <!--            <th scope="col" appSortable="p-value" (sort)="onSort($event)">p-value</th>-->
        <th (sort)="onSort($event)" [style.paddingRight]="0" appSortable="q-value" scope="col">
          q-value
        </th>
        <th [ngbTooltip]="legend" openDelay="500" placement="bottom-right top-right" scope="col">
          <span class="hidden-text">Significance marker</span>
        </th>
      </tr>
    </thead>
    <tbody [ngClass]="{ 'line-clamp': !service.searchTerm }">
      <tr *ngFor="let row of data$ | async; let i = index" [tabindex]="i">
        <td>{{ row.goId }}</td>
        <th scope="row">
          <ngb-highlight [result]="row.goTerm" [term]="service.searchTerm"></ngb-highlight>
        </th>
        <td>
          <span [className]="'gene-list'">
            <ng-container *ngFor="let gene of row['geneNames']; let last = last">
              <ngb-highlight
                [appSELink]="gene"
                [result]="gene"
                [term]="service.searchTerm"
              ></ngb-highlight>
              <ng-container *ngIf="!last">, </ng-container>
            </ng-container>
          </span>
        </td>
        <!--            <td>-->
        <!--                <ngb-highlight [result]="row['p-value'].toExponential(2)"-->
        <!--                               [style.whiteSpace]="'pre'"-->
        <!--                               [term]="service.searchTerm"></ngb-highlight>-->
        <!--            </td>-->
        <td [style.paddingRight]="0">
          <ngb-highlight
            [result]="row['q-value'].toExponential(2)"
            [style.whiteSpace]="'pre'"
            [term]="service.searchTerm"
          ></ngb-highlight>
        </td>
        <td
          [ngbTooltip]="legend"
          [style.paddingLeft]="0"
          openDelay="1000"
          placement="top-right bottom-right"
        >
          <ngb-highlight
            [result]="significanceIndicator(row['q-value'])"
            [term]="service.searchTerm"
          ></ngb-highlight>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="showMore" class="d-flex justify-content-between p-2" style="flex-wrap: wrap">
    <ngb-pagination
      [(page)]="service.page"
      [collectionSize]="(total$ | async)!"
      [pageSize]="service.pageSize"
    >
    </ngb-pagination>

    <select
      [(ngModel)]="service.pageSize"
      class="custom-select"
      name="pageSize"
      style="width: auto"
    >
      <option [ngValue]="15">15 items per page</option>
      <option [ngValue]="30">30 items per page</option>
      <option [ngValue]="100">100 items per page</option>
    </select>
  </div>
</form>
