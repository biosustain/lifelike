<div class="w-100 h-100">
  <as-split cdkDropListGroup unit="pixel" direction="horizontal" gutterSize="5">
    <as-split-area [size]="370" [minSize]="300" [maxSize]="500">
      <div class="overflow-auto flex-shrink-0 h-100">
        <app-map-list (projectAPICaller)="handleAPI($event)"
                      [selectedProject]="selectedProject">
        </app-map-list>
      </div>
    </as-split-area>

    <as-split-area>
      <div class="module module-document h-100" *ngIf="selectedProject else empty">
        <div class="module-header-container">
          <div class="module-header">
            <div class="module-title d-flex align-items-center">
              <div class="text-truncate">
                {{selectedProject?.label}}
                <small *ngIf="selectedProject?.public" class="ml-1 text-muted"
                       ngbTooltip="This project is public and can be seen by others under 'Community',
                      although only its owner can edit it">
                  <i class="fa fa-fw fa-unlock"></i>
                </small>
                <small *ngIf="!selectedProject?.public" class="ml-1 text-muted"
                       ngbTooltip="This project can only be seen and edited by its owners.">
                  <i class="fa fa-fw fa-lock"></i>
                </small>
              </div>
              <div class="ml-2">
                <button type="button" class="btn btn-outline-secondary btn-sm" (click)='editProject()'
                        ngbTooltip="Edit the title, summary, or make this project {{selectedProject?.public ? 'private' : 'public'}}"
                        *ngIf='isItMine'>
                  <i class="fa fa-fw fa-pencil"></i>
                </button>
              </div>
            </div>

            <div class="module-toolbar">
              <div *ngIf='isItMine'>
                <button type="button" class="btn btn-primary" (click)='goToProject()'
                        ngbTooltip="Edit the map">
                  <i class="fa fa-fw fa-pencil"></i>
                  Edit
                </button>
                <button type="button" class="btn btn-outline-secondary ml-1" (click)='downloadProject()'
                        ngbTooltip="Export project data"
                        *ngIf="(userRoles$ | async)?.includes('admin')">
                  <i class="fa fa-fw fa-download"></i>
                </button>
                <button type="button" class="btn btn-outline-secondary ml-1" (click)='deleteProject()'
                        ngbTooltip="Delete this project">
                  <i class="fa fa-fw fa-trash"></i>
                </button>
              </div>
              <div *ngIf='!isItMine'>
                <button type="button" class="btn btn-primary" (click)='copyProject()'
                        ngbTooltip="Copy this project to your account">
                  <i class="fa fa-fw fa-clone"></i>
                  Duplicate
                </button>
                <button type="button" class="btn btn-outline-secondary ml-1" (click)='downloadProject()'
                        ngbTooltip="Export project as Lifelike Map file"
                        *ngIf="(userRoles$ | async)?.includes('admin')">
                  <i class="fa fa-fw fa-download"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="module-body flex-fill overflow-hidden d-flex">
          <div class="position-relative flex-fill map-preview-container">
            <app-map-preview #previewComponent [project]='selectedProject'></app-map-preview>

            <div class="top-toolbar d-flex align-items-center" *ngIf="!infoPinned">
              <div class="btn-group">
                <button type="button" class="btn btn-secondary" (click)="infoPinned = !infoPinned"
                        ngbTooltip="Show description." placement="right">
                  <i class="fa fa-fw fa-angle-right"></i>
                </button>
              </div>
            </div>

            <div class="bottom-toolbar d-flex align-items-center">
              <div class="btn-toolbar">
                <div class="btn-group">
                  <button type="button" class="btn btn-secondary"
                          ngbTooltip="Zoom to make the map fit if it doesn't fit"
                          (click)="zoomToFit()">
                    <i class="fa fa-fw fa-expand"></i> Fit Map
                  </button>
                </div>
              </div>
            </div>

            <div class="detail-overlay" [class.pinned]="infoPinned">
              <button type="button" class="close float-right" aria-label="Close"
                      (click)="infoPinned = false" *ngIf="infoPinned">
                <span aria-hidden="true">&times;</span>
              </button>
              <div class="detail-overlay-properties text-muted">
                <div class="text-truncate">
                  By {{selectedProject?.author}}
                </div>
                <div class="text-truncate">
                  Modified {{selectedProject?.date_modified | friendlyDateStr}}
                </div>
              </div>
              <div class="mt-2 detail-overlay-description">
                {{selectedProject?.description}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </as-split-area>
  </as-split>
</div>

<!-- Empty Scene -->
<ng-template #empty>
  <div fxFill fxLayout='column' fxLayoutAlign="center center" class='empty h-100'>
    <p>Create or select a map</p>
  </div>
</ng-template>
