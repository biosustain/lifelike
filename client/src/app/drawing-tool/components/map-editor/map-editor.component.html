<div class="position-relative h-100" #modalContainer>
  <ng-container *ngIf="(loadTask.status$ | async) as status">
    <app-content-progress
      [status]="status"
      loadingText="Fetching map..."
      errorText="The requested map could not be loaded.">
    </app-content-progress>
  </ng-container>

  <div class="position-absolute w-100 h-100 d-flex flex-column" style="z-index: 0">
    <div class="toolbar">
      <div class="toolbar-header d-flex align-items-center">
        <h2 class="toolbar-title text-truncate">
          <button type="button" class="btn btn-sm btn-link" (click)="goToReturnUrl()" *ngIf="returnUrl">
            <i class="fa fa-fw fa-arrow-left"></i>
          </button>
          <span (click)="displayEditDialog()">{{ map?.label }}</span>
        </h2>
        <div class="text-danger ml-2" *ngIf="unsavedChanges$.value; else saved">
          <i class="fa fa-fw fa-pencil-alt"></i> Unsaved changes
        </div>
        <ng-template #saved>
          <div class="ml-2 text-muted" ngbTooltip="Saved to the cloud" container="body">
            <i class="fa fa-fw fa-cloud-upload-alt"></i>
          </div>
        </ng-template>
      </div>

      <div class="toolbar-body d-flex align-items-center">
        <div class="btn-group">
          <button type="button" class="btn btn-secondary"
                  [disabled]="(unsavedChanges$ | async) == null"
                  ngbTooltip="Save" placement="bottom" container="body"
                  (click)="save()">
            <i class="fa fa-fw fa-save"></i> Save
          </button>
          <button type="button" class="btn btn-secondary"
                  ngbTooltip="Download map as an image or PDF" placement="bottom" container="body"
                  (click)="download()">
            <i class="fa fa-fw fa-file-export"></i> Export
          </button>
        </div>

        <div class="btn-group ml-2">
          <button type="button" class="btn btn-secondary"
                  ngbTooltip="Undo" placement="bottom" container="body"
                  (click)="undo()"
                  [disabled]="!graphCanvas || !graphCanvas.canUndo()">
            <i class="fa fa-fw fa-undo"></i>
          </button>
          <button type="button" class="btn btn-secondary"
                  ngbTooltip="Redo" placement="bottom" container="body"
                  (click)="redo()"
                  [disabled]="!graphCanvas || !graphCanvas.canRedo()">
            <i class="fa fa-fw fa-redo"></i>
          </button>
        </div>

        <div class="btn-group ml-2">
          <button type="button" class="btn btn-secondary" container="body"
                  ngbTooltip="Make map fit on screen" placement="bottom"
                  (click)="zoomToFit()">
            Fit to Map
          </button>
        </div>

        <div class="input-group ml-2" style="width: 300px;">
          <input type="text" class="form-control" placeholder="Search" aria-label="Graph search" aria-describedby="graph-search">
          <div class="input-group-append">
            <span class="input-group-text" id="increment-btn">
              {{entitySearchListIdx}} of {{entitySearchList.length}}
            </span>
          </div>
          <div class="input-group-append" id="decrement-btn">
            <button class="btn btn-secondary" type="button">
              <i class="fa fa-fw fa-chevron-up"></i>
            </button>
            <button class="btn btn-secondary" type="button">
              <i class="fa fa-fw fa-chevron-down"></i>
            </button>
          </div>
        </div>

      </div>
    </div>

    <div class="flex-fill position-relative overflow-hidden">
      <div class="graph-container">
        <canvas #canvas class="graph-view" (dragover)="dragOver($event)" (drop)="drop($event)"></canvas>
      </div>

      <div class="palette-panel">
        <app-collapsible-window title="Palette" [reversed]="true" class="flex-fill">
          <div class="window-body">
            <app-palette></app-palette>
          </div>
        </app-collapsible-window>
      </div>

      <ng-container *ngIf="(graphCanvas?.selection.changeObservable | async) as selected">
        <div class="info-panel" *ngIf="selected[0].length > 0">
          <app-info-panel [selected]="selected[0][0]"
                          (actionCreated)="graphCanvas.execute($event)">
          </app-info-panel>
        </div>
      </ng-container>
    </div>
  </div>
</div>
