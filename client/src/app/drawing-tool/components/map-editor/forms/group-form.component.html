<div class="d-flex flex-column h-100">
    <ul ngbNav #nav="ngbNav" [(activeId)]="infoPanel.activeTab" class="nav-tabs nav-sidebar-tabs">
        <li ngbNavItem="properties">
            <a ngbNavLink>Properties</a>
            <ng-template ngbNavContent>
                <div class="form-group">
                    <label for="label">
                        Group Label:
                    </label>
                    <input [(ngModel)]="group.display_name" class="form-control map-editor-initial-focus"
                           (change)="doSave()" id="label" maxlength="2000"
                           #displayName>
                </div>

                <div class="form-group">
                    <label for="detail">Detail:</label>
                    <div class="form-control textarea-grow-wrap" [attr.data-replicated-value]="group.data.detail">
                        <textarea  [(ngModel)]="group.data.detail" cdkTextareaAutosize
                                   cdkAutosizeMinRows="2"
                                  (change)="doSave()"
                                  id="detail"
                                  maxlength="5000"></textarea>
                    </div>
                </div>

                <div class="mb-4">
                    <app-links-panel title="Sources" singularTitle="Source" fontAwesomeIcon="far fa-book"
                                     [(ngModel)]="group.data.sources"
                                     (ngModelChange)="doSave()"></app-links-panel>
                </div>

                <div class="mb-4">
                    <app-links-panel title="Hyperlinks" singularTitle="Hyperlink"
                                     [(ngModel)]="group.data.hyperlinks"
                                     (ngModelChange)="doSave()"></app-links-panel>
                </div>

                <ng-container *ngIf="!overflow" [ngTemplateOutlet]="search"></ng-container>
                <ng-container *ngIf="overflow" [ngTemplateOutlet]="delete"></ng-container>

            </ng-template>
        </li>
        <li ngbNavItem="search" *ngIf="overflow">
            <a ngbNavLink>Search</a>
            <ng-template ngbNavContent>
                <ng-container [ngTemplateOutlet]="search">
                </ng-container>
            </ng-template>
        </li>
        <li ngbNavItem="style">
            <a ngbNavLink>Style</a>
            <ng-template ngbNavContent>
                <fieldset class="fieldset-properties">
                    <legend>Group Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label class="my-0 mr-2" ngbTooltip="Margin size" container="body">
                            <i class="fa fa-fw fa-arrows-alt-h"></i>
                        </label>
                        <input type="number" [value]="group.margin"
                               class="form-control mr-1"
                                [min]="0" [max]="100" [step]="2" (change)="updateMargin($event)"
                                [style.width]="'6rem'">
                        px
                    </div>
                </fieldset>
                <fieldset class="fieldset-properties">
                    <legend>Label Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label for="font-size" class="my-0 mr-2" ngbTooltip="Font size" container="body">
                            <i class="fa fa-fw fa-text-height"></i>
                        </label>
                        <app-percent-input min="20" max="1000" step="20" class="mr-1"
                                           [(value)]="group.style.fontSizeScale" (change)="doSave()"
                                           default="100"
                                           inputId="font-size"
                                           [style.width]="'6rem'"></app-percent-input>
                        %
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label class="my-0 mr-2" ngbTooltip="Text color" container="body">
                            <i class="fa fa-fw fa-brush"></i>
                        </label>
                        <app-color-chooser-component
                                id="fill-color" [palette]="paletteChoices"
                                [(color)]="group.style.fillColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label class="my-0 mr-2" ngbTooltip="Background color" container="body">
                            <i class="fa fa-fw fa-fill"></i>
                        </label>
                        <app-color-chooser-component
                                id="bg-color" [palette]="bgPaletteChoices"
                                [(color)]="group.style.bgColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>
                </fieldset>

                <fieldset class="fieldset-properties mt-4">
                    <legend>Border Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label for="stroke-color" class="my-0 mr-2" ngbTooltip="Border color" container="body">
                            <i class="fa fa-fw fa-fill"></i>
                        </label>
                        <app-color-chooser-component
                                id="stroke-color" [palette]="paletteChoices"
                                [(color)]="group.style.strokeColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label for="line-type" class="my-0 mr-2" ngbTooltip="Border line type" container="body">
                            <i class="fa fa-fw fa-border-style"></i>
                        </label>
                        <select [(ngModel)]="group.style.lineType" (change)="doSave()" class="custom-select"
                                id="line-type">
                            <option *ngFor="let choice of lineTypeChoices" [value]="choice[0]">
                                {{choice[1].name}}
                            </option>
                        </select>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label for="line-width-scale" class="my-0 mr-2" ngbTooltip="Border line thickness"
                               container="body">
                            <i class="fa fa-fw fa-window-minimize"></i>
                        </label>
                        <app-percent-input min="20" max="1000" step="20" class="mr-1"
                                           [(value)]="group.style.lineWidthScale" (change)="doSave()"
                                           default="100"
                                           inputId="line-width-scale"
                                           [style.width]="'6rem'"></app-percent-input>
                        %
                    </div>
                </fieldset>
                <ng-container [ngTemplateOutlet]="delete"></ng-container>
            </ng-template>
        </li>
    </ul>
    <div class="overflow-auto h-100" #scrollWrapper>
        <div class="module-body">
            <div [ngbNavOutlet]="nav"></div>
        </div>
    </div>
</div>

<ng-template #search>
<!--    <fieldset class="fieldset-properties mb-4"-->
<!--              *ngIf="(group.display_name != null && group.display_name.length) || group.data?.search">-->
<!--        <legend>Search Internal <i class="fas fa-external-link-alt ml-1"></i></legend>-->

<!--        <ul class="list-unstyled m-0">-->
<!--            <li class="text-truncate">-->
<!--                <div class="btn btn-link p-0" (click)="searchMapNodeInVisualizer(node)">-->
<!--                    Knowledge Graph-->
<!--                </div>-->
<!--            </li>-->
<!--            <li class="text-truncate">-->
<!--                <div class="btn btn-link p-0" (click)="searchMapNodeInContent(node, '')">-->
<!--                    File Content-->
<!--                </div>-->
<!--            </li>-->
<!--            <li class="text-truncate">-->
<!--                <div class="btn btn-link p-0" (click)="searchMapNodeInContent(node, 'map')">-->
<!--                    Map Content-->
<!--                </div>-->
<!--            </li>-->
<!--        </ul>-->
<!--    </fieldset>-->
<!--    <fieldset class="fieldset-properties mb-4"-->
<!--              *ngIf="(node.display_name != null && node.display_name.length) || node.data?.search">-->
<!--        <legend>Search External <i class="fas fa-external-link-alt ml-1"></i></legend>-->
<!--        <app-quick-search [query]="node.display_name"-->
<!--                          [links]="node.data?.search"></app-quick-search>-->
<!--    </fieldset>-->
<!--    <ng-container [ngTemplateOutlet]="delete"></ng-container>-->
</ng-template>

<ng-template #delete>
    <div class="mb-4">
        <button (click)="doDelete()" type="button" class="btn btn-danger btn-block">
            Ungroup
        </button>
    </div>
</ng-template>
