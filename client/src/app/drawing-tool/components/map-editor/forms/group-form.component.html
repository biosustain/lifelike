<div class="d-flex flex-column h-100">
    <ul ngbNav #nav="ngbNav" [(activeId)]="infoPanel.activeTab" class="nav-tabs nav-sidebar-tabs">
        <li ngbNavItem="properties">
            <a ngbNavLink>Properties</a>
            <ng-template ngbNavContent>
                <div class="form-group">
                    <label for="label">
                        Group Label:
                    </label>
                    <input [(ngModel)]="group.display_name" class="form-control"
                           (change)="doSave()" id="label" maxlength="2000"
                           #displayName>
                </div>

                <div class="form-group">
                    <label for="detail">Detail:</label>
                    <div class="form-control textarea-grow-wrap" [attr.data-replicated-value]="group.data.detail">
                        <textarea  [(ngModel)]="group.data.detail" cdkTextareaAutosize
                                   cdkAutosizeMinRows="2"
                                  (change)="doSave()"
                                  id="detail"
                                  maxlength="5000"></textarea>
                    </div>
                </div>

                <div class="mb-4">
                    <app-links-panel title="Sources" singularTitle="Source" fontAwesomeIcon="far fa-book"
                                     [(ngModel)]="group.data.sources"
                                     (ngModelChange)="doSave()"></app-links-panel>
                </div>

                <div class="mb-4">
                    <app-links-panel title="Hyperlinks" singularTitle="Hyperlink"
                                     [(ngModel)]="group.data.hyperlinks"
                                     (ngModelChange)="doSave()"></app-links-panel>
                </div>

                <ng-container *ngIf="overflow" [ngTemplateOutlet]="delete"></ng-container>

            </ng-template>
        </li>
        <li ngbNavItem="style">
            <a ngbNavLink>Style</a>
            <ng-template ngbNavContent>
                <fieldset class="fieldset-properties">
                    <legend>Group Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label
                          class="my-0 mr-2"
                          ngbTooltip="Margin size"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-arrows-alt-h"></i>
                        </label>
                        <input type="number" [value]="group.margin"
                               class="form-control mr-1"
                                [min]="0" [max]="100" [step]="2" (change)="updateMargin($event)"
                                [style.width]="'6rem'">
                        px
                    </div>
                </fieldset>
                <fieldset class="fieldset-properties">
                    <legend>Label Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label
                          [for]="fontSize.uid"
                          class="my-0 mr-2"
                          ngbTooltip="Font size"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-text-height"></i>
                        </label>
                        <app-percent-input
                            #fontSize="uid" appUid
                            [min]="20" [max]="1000" [step]="20" class="mr-1"
                            #model="ngModel"
                            [ngModel]="group.style.fontSizeScale || 1"
                            (ngModelChange)="model.valid && group.style.fontSizeScale = $event"
                            (change)="model.valid && doSave()"
                            appAutoGrow
                        ></app-percent-input>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label
                          class="my-0 mr-2"
                          ngbTooltip="Text color"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-brush"></i>
                        </label>
                        <app-color-chooser-component
                                id="fill-color" [palette]="paletteChoices"
                                [(color)]="group.style.fillColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label
                          class="my-0 mr-2"
                          ngbTooltip="Background color"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-fill"></i>
                        </label>
                        <app-color-chooser-component
                                id="bg-color" [palette]="bgPaletteChoices"
                                [(color)]="group.style.bgColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>
                </fieldset>

                <fieldset class="fieldset-properties mt-4">
                    <legend>Border Style</legend>

                    <div class="form-group d-flex align-items-center">
                        <label
                          for="stroke-color"
                          class="my-0 mr-2"
                          ngbTooltip="Border color"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-fill"></i>
                        </label>
                        <app-color-chooser-component
                                id="stroke-color" [palette]="paletteChoices"
                                [(color)]="group.style.strokeColor" emptyLabel="Default"
                                (colorChange)="doSave()"></app-color-chooser-component>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label
                          for="line-type"
                          class="my-0 mr-2"
                          ngbTooltip="Border line type"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-border-style"></i>
                        </label>
                        <select [(ngModel)]="group.style.lineType" (change)="doSave()" class="custom-select"
                                id="line-type">
                            <option *ngFor="let choice of lineTypeChoices" [value]="choice[0]">
                                {{choice[1].name}}
                            </option>
                        </select>
                    </div>

                    <div class="form-group d-flex align-items-center">
                        <label
                          [for]="lineWidthScale.uid"
                          class="my-0 mr-2"
                          ngbTooltip="Border line thickness"
                          container="body"
                          #tooltipRef="ngbTooltip"
                          [appAutoCloseTooltipOutOfView]="tooltipRef"
                        >
                            <i class="fa fa-fw fa-window-minimize"></i>
                        </label>
                        <app-percent-input
                            #lineWidthScale="uid" appUid
                            [min]="20" [max]="1000" [step]="20" class="mr-1"
                            #model="ngModel"
                            [ngModel]="group.style.lineWidthScale || 1"
                            (ngModelChange)="model.valid && group.style.lineWidthScale = $event"
                            (change)="model.valid && doSave()"
                            appAutoGrow
                        ></app-percent-input>
                    </div>
                </fieldset>
                <ng-container [ngTemplateOutlet]="delete"></ng-container>
            </ng-template>
        </li>
    </ul>
    <div class="overflow-auto h-100" #scrollWrapper>
        <div class="module-body">
            <div [ngbNavOutlet]="nav"></div>
        </div>
    </div>
</div>

<ng-template #delete>
    <div class="mb-4">
        <button (click)="doDelete()" type="button" class="btn btn-danger btn-block">
            Ungroup
        </button>
    </div>
</ng-template>
