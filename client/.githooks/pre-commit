#!/bin/sh
__dir__="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
root_dir="$( cd "$( dirname "${__dir__}}" )" &> /dev/null && pwd )"

# Runs linting on only files that are staged
cd $root_dir

staged_files=$(git diff --cached --name-status --diff-filter=AM | cut -f 2 | grep -E '\.(js|ts)$' | sed 's/client\///g' | xargs printf -- '--files=%s\n')
staged_renamed_files=$(git diff --cached --name-status --diff-filter=R | cut -f 3 | grep -E '\.(js|ts)$' | sed 's/client\///g' | xargs printf -- '--files=%s\n')
all_staged_files="${staged_files}\n${staged_renamed_files}"

echo "> ðŸ§¶ Running yarn lint.."
echo ${all_staged_files} | xargs ng lint -- --tsConfig=tsconfig.json 2>/dev/null
