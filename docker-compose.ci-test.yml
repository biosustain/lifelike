# CI Test
version: "3.8"

services:
  appserver:
    image: lifelike.azurecr.io/kg-appserver:${GITHUB_HASH}
    environment:
      - NEO4J_HOST=neo4j
      - NEO4J_AUTH=neo4j/password
      - NEO4J_PORT=7687
      - FLASK_DEBUG=1
      - FLASK_ENV=development
      - FLASK_APP=app
      - FLASK_APP_CONFIG=Development
      - POSTGRES_HOST=postgres
      - POSTGRES_PORT=5432
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=postgres
      - REDIS_PORT=6379
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
      - ELASTIC_FILE_INDEX_ID=file_ci
      - LMDB_HOME_FOLDER=/home/n4j/neo4japp/services/annotations/lmdb/
    depends_on:
      - postgres
      - elasticsearch
      - neo4j

  postgres:
    image: postgres:13
    restart: on-failure
    environment:
      - POSTGRES_PASSWORD=postgres

  neo4j:
    image: neo4j:4.4-community
    restart: on-failure
    environment:
      - NEO4J_AUTH=neo4j/password

  elasticsearch:
    image: ghcr.io/sbrg/lifelike-elasticsearch:latest
    restart: on-failure

